language: go
dist: bionic

go:
  - 1.13.x

git:
  depth: 1

before_install:
  - go version
  - echo $DEBSIGN | base64 -d | gpg --import --batch
  - echo 'aaaaaaaa' > passphrase_file
  - bundle install

script:
  - make -j $(grep -c ^processor /proc/cpuinfo)

deploy:
  skip_cleanup: true
  provider: script
  script: bundle install && bundle exec deb-s3 upload --s3-region=eu-west-1 --sign=6A2561804E290210909454E69640EFFBAA3B94A5 --gpg-options="\-\-pinentry\-mode=loopback \-\-passphrase\-file passphrase_file \-\-batch" --suite stable --origin "Andrew Rowson" --bucket apt-growse-com *.deb
