language: ruby
dist: bionic
go:
  - 1.12.3
ruby:
  - 2.6.3
git:
  depth: 1

env:
  - GO111MODULE=on

before_install:
  - echo $DEBSIGN | base64 -d | gpg --import
  - echo 'aaaaaaaa' > passphrase_file
  - bundle install

script:
  - make

deploy:
  skip_cleanup: true
  provider: script
  script: bundle install && bundle exec deb-s3 upload --s3-region=eu-west-1 --sign=6A2561804E290210909454E69640EFFBAA3B94A5 --gpg-options="\-\-pinentry\-mode=loopback \-\-passphrase\-file passphrase_file \-\-batch" --suite stable --origin "Andrew Rowson" --bucket apt-growse-com *.deb

#  script: bundle install && bundle exec deb-s3 upload --s3-region=eu-west-1 --suite stable --origin "Andrew Rowson" --sign=63F29D43F8F9E605 --bucket apt-growse-com growse-com-golang_1.0.1-"$TRAVIS_BUILD_NUMBER"_amd64.deb
