language: ruby
dist: bionic

ruby:
  - 2.6.3
git:
  depth: 1


env:
  - GO111MODULE=on GOVERSION=1.13 PATH=$PATH:/usr/lib/go-$GOVERSION/bin

before_install:
  - sudo apt-add-repository -y ppa:longsleep/golang-backports
  - sudo apt-get update -q
  - sudo apt-get install -y golang-${GOVERSION}-go
  - echo $PATH
  - ls -laht /usr/lib/go-$GOVERSION/bin
  - which go
  - go version
  - echo $DEBSIGN | base64 -d | gpg --import --batch
  - echo 'aaaaaaaa' > passphrase_file
  - bundle install

script:
  - make -j $(grep ^processor /proc/cpuinfo)

deploy:
  skip_cleanup: true
  provider: script
  script: bundle install && bundle exec deb-s3 upload --s3-region=eu-west-1 --sign=6A2561804E290210909454E69640EFFBAA3B94A5 --gpg-options="\-\-pinentry\-mode=loopback \-\-passphrase\-file passphrase_file \-\-batch" --suite stable --origin "Andrew Rowson" --bucket apt-growse-com *.deb
